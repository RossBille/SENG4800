<!DOCTYPE html>
<html>
	<head>
		<title>Client Request</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	</head>
	<body>
            <div align="center">
		<h1>Client Request Test</h1>
		<div>
                    This page simulates the initial connection request from a client to the Connection Broker. <br>                  
                </div><br>
		<div id="output"></div><br>
		<button onclick="request();" >Send Connection Request</button>
		<script type="text/javascript" >

                        var broker = "ws://localhost:8080/Input/entry";
			var websocket = new WebSocket(broker);

			websocket.onerror = function(evt) 
                        {
				onError(evt);
			};

			function onError(evt) 
                        {
				writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
			}
                        
			// For testing purposes
			var output = document.getElementById("output");
                        
			websocket.onopen = function(evt) 
                        {
				onOpen(evt);
			};
                        
                        websocket.onmessage = function(evt)
                        {
                            onMessage(evt)
                        };
                        
                        function onMessage(evt)
                        {
                            output.innerHTML += evt.data + "<br>";
                        }
			
			function writeToScreen(message) 
                        {
				output.innerHTML += message + "<br>";
			}

			function onOpen() 
                        {
				writeToScreen("Connected to " + broker + "<br>");
			}
                       
			function request()
			{
				var object = new Object();
				object.phoneId = "Rowans Phone";
				object.os = "iOS";
                                websocket.send(stringit(object, "au.edu.newcastle.seng48002013.instructions.phone.TouchScreen"));
			}
	
			// End test functions

			//write json object with class attribute
			function stringit(obj, cls)
			{
				cls = "{\"@class\":\""+cls+"\",";
				var js = JSON.stringify(obj);	
				js = js.substr(1);
				js = cls + js;
				return js;	
			}
		</script>
                </div>
	</body>
</html>
